<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135618258-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-135618258-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="MikroORM" href="/opensearch.xml">
<script src="/js/custom.js"></script><title data-react-helmet="true">Working with Entity Manager | MikroORM</title><meta data-react-helmet="true" name="docsearch:version" content="2.7"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Working with Entity Manager | MikroORM"><meta data-react-helmet="true" name="description" content="Persist and flush"><meta data-react-helmet="true" property="og:description" content="Persist and flush"><meta data-react-helmet="true" property="og:url" content="https://mikro-orm.io/docs/2.7/entity-manager"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://mikro-orm.io/docs/2.7/entity-manager"><link rel="stylesheet" href="/styles.3430c5d5.css">
<link rel="preload" href="/styles.6a75a1a0.js" as="script">
<link rel="preload" href="/runtime~main.f90667eb.js" as="script">
<link rel="preload" href="/main.0ac60c5e.js" as="script">
<link rel="preload" href="/1.d471f77f.js" as="script">
<link rel="preload" href="/2.70f15892.js" as="script">
<link rel="preload" href="/3.85c74ff8.js" as="script">
<link rel="preload" href="/1be78505.b2f3141d.js" as="script">
<link rel="preload" href="/325.d47dc706.js" as="script">
<link rel="preload" href="/eab67868.df58518e.js" as="script">
<link rel="preload" href="/17896441.9e54765d.js" as="script">
<link rel="preload" href="/b550954d.a15a6abb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_3046"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="MikroORM"><strong class="navbar__title"></strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/docs/2.7/installation">2.7</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/entity-manager">Next</a></li><li><a class="dropdown__link" href="/docs/entity-manager">4.2</a></li><li><a class="dropdown__link" href="/docs/4.1/entity-manager">4.1</a></li><li><a class="dropdown__link" href="/docs/4.0/entity-manager">4.0</a></li><li><a class="dropdown__link" href="/docs/3.6/entity-manager">3.6</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.7/entity-manager">2.7</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/installation">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" data-type="versions" href="/versions">latest: v4.2.1</a><a href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" title="Chat on Slack">Slack</a><a href="https://github.com/mikro-orm/mikro-orm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" title="View on GitHub">GitHub</a><a href="https://twitter.com/MikroORM" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" title="Twitter">Twitter</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="MikroORM"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/entity-manager">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/entity-manager">4.2</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/4.1/entity-manager">4.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/4.0/entity-manager">4.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/3.6/entity-manager">3.6</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/2.7/entity-manager">2.7</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" data-type="versions" href="/versions">latest: v4.2.1</a></li><li class="menu__list-item"><a href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA" target="_blank" rel="noopener noreferrer" class="menu__link" title="Chat on Slack">Slack</a></li><li class="menu__list-item"><a href="https://github.com/mikro-orm/mikro-orm" target="_blank" rel="noopener noreferrer" class="menu__link" title="View on GitHub">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/MikroORM" target="_blank" rel="noopener noreferrer" class="menu__link" title="Twitter">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC sidebarWithHideableNavbar_2IoJ"><a tabindex="-1" class="sidebarLogo_Snse" href="/"><img src="/img/logo.svg" alt="MikroORM"><strong></strong></a><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7/installation">Installation &amp; Usage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7/defining-entities">Defining entities</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/2.7/entity-manager">Entity Manager</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7/repositories">Entity Repository</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Fundamentals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/identity-map">Identity Map and Request Context</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/entity-references">Entity References</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/entity-constructors">Using entity constructors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/collections">Collections</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/unit-of-work">Unit of Work</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/transactions">Transactions and concurrency</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/cascading">Cascading</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/nested-populate">Smart Nested Populate</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/query-conditions">Smart query conditions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/query-builder">Using QueryBuilder</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/serializing">Serializing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/entity-helper">Updating Entity Values</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/property-validation">Property validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/lifecycle-hooks">Lifecycle hooks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/naming-strategy">Naming strategy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/metadata-cache">Metadata cache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/schema-generator">Schema generator</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Usage with Different Drivers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/usage-with-sql">Usage with SQL Drivers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/usage-with-mongo">Usage with MongoDB</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Recipes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/usage-with-nestjs">Usage with NestJS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/usage-with-js">Usage with Vanilla JS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/2.7/custom-driver">Creating Custom Driver</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for MikroORM <strong>2.7</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/entity-manager">latest version</a></strong> (4.2).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 2.7</span></div><header><h1 class="docTitle_1Lrw">Working with Entity Manager</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="persist-and-flush"></a>Persist and flush<a aria-hidden="true" tabindex="-1" class="hash-link" href="#persist-and-flush" title="Direct link to heading">#</a></h2><p>There are 2 methods we should first describe to understand how persisting works in MikroORM:
<code>em.persist()</code> and <code>em.flush()</code>.</p><p><code>em.persist(entity, flush?: boolean)</code> is used to mark new entities for future persisting.
It will make the entity managed by given <code>EntityManager</code> and once <code>flush</code> will be called, it
will be written to the database. Second boolean parameter can be used to invoke <code>flush</code>
immediately. Its default value is configurable via <code>autoFlush</code> option.</p><p>To understand <code>flush</code>, lets first define what managed entity is: An entity is managed if
itâ€™s fetched from the database (via <code>em.find()</code>, <code>em.findOne()</code> or via other managed entity)
or registered as new through <code>em.persist()</code>.</p><p><code>em.flush()</code> will go through all managed entities, compute appropriate change sets and
perform according database queries. As an entity loaded from database becomes managed
automatically, you do not have to call persist on those, and flush is enough to update
them.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="persisting-and-cascading"></a>Persisting and cascading<a aria-hidden="true" tabindex="-1" class="hash-link" href="#persisting-and-cascading" title="Direct link to heading">#</a></h2><p>To save entity state to database, you need to persist it. Persist takes care or deciding
whether to use <code>insert</code> or <code>update</code> and computes appropriate change-set. Entity references
that are not persisted yet (does not have identifier) will be cascade persisted automatically. </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// use constructors in your entities for required parameters</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> author </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Author</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Jon Snow&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;snow@wall.st&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">born</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> publisher </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Publisher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;7K publisher&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> book1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Book</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;My Life on The Wall, part 1&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">book1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publisher</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> publisher</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> book2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Book</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;My Life on The Wall, part 2&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">book2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publisher</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> publisher</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> book3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Book</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;My Life on The Wall, part 3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> author</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">book3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publisher</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> publisher</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// just persist books, author and publisher will be automatically cascade persisted</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">persistAndFlush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">book1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> book2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> book3</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// or one by one</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">persistLater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">persistLater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">persistLater</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// flush everything to database at once</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="auto-flushing"></a>Auto flushing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#auto-flushing" title="Direct link to heading">#</a></h3><p>By default, <code>EntityManager.persist()</code> will <strong>flush your changes automatically</strong>. You can use
its second parameter to disable auto-flushing, and use <code>EntityManager.flush()</code> manually. </p><p>You can also disable this feature globally via <code>autoFlush</code> option when initializing the ORM:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> orm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token maybe-class-name">MikroORM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  autoFlush</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">persist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Entity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// no auto-flushing now</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">persist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Entity</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// you can still use second parameter to auto-flush</span></div></div></div></div></div><blockquote><p>Default value of <code>autoFlush</code> is currently set to <code>true</code>, which will change in upcoming major
release. Users are encouraged to either set <code>autoFlush</code> to <code>false</code> or use <code>em.persistLater()</code>
(equal to <code>em.persist(entity, false)</code>) and <code>em.persistAndFlush()</code> methods instead. </p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="fetching-entities-with-entitymanager"></a>Fetching entities with EntityManager<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fetching-entities-with-entitymanager" title="Direct link to heading">#</a></h2><p>To fetch entities from database you can use <code>find()</code> and <code>findOne()</code> of <code>EntityManager</code>: </p><p>Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> author </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;...id...&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> books </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Book</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> author </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> authors</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Jon Snow</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> book </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">books</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">title</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// initialized</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isInitialized</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// true</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Jon Snow</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publisher</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// just reference</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publisher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isInitialized</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// false</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publisher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">publisher</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// undefined</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="fetching-partial-entities"></a>Fetching partial entities<a aria-hidden="true" tabindex="-1" class="hash-link" href="#fetching-partial-entities" title="Direct link to heading">#</a></h3><p>When fetching single entity, you can choose to select only parts of an entity via <code>options.fields</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> author </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;...&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> fields</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;born&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// PK is always selected</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Jon Snow</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// undefined</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="type-of-fetched-entities"></a>Type of fetched entities<a aria-hidden="true" tabindex="-1" class="hash-link" href="#type-of-fetched-entities" title="Direct link to heading">#</a></h2><p>Both <code>EntityManager.find</code> and <code>EntityManager.findOne()</code> methods have generic return types.
All of following examples are equal and will let typescript correctly infer the entity type:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> author1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">findOne</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Author</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;...id...&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> author2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">findOne</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token maybe-class-name">Author</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Author&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;...id...&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> author3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> orm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;...id...&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><p>As the last one is the least verbose, it should be preferred. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="entity-repositories"></a>Entity repositories<a aria-hidden="true" tabindex="-1" class="hash-link" href="#entity-repositories" title="Direct link to heading">#</a></h2><p>Although you can use <code>EntityManager</code> directly, much more convenient way is to use
<a href="https://mikro-orm.io/repositories/" target="_blank" rel="noopener noreferrer"><code>EntityRepository</code> instead</a>. You can register
your repositories in dependency injection container like <a href="http://inversify.io/" target="_blank" rel="noopener noreferrer">InversifyJS</a>
so you do not need to get them from <code>EntityManager</code> each time.</p><p>For more examples, take a look at
<a href="https://github.com/mikro-orm/mikro-orm/blob/master/tests/EntityManager.mongo.test.ts" target="_blank" rel="noopener noreferrer"><code>tests/EntityManager.mongo.test.ts</code></a>
or <a href="https://github.com/mikro-orm/mikro-orm/blob/master/tests/EntityManager.mongo.test.ts" target="_blank" rel="noopener noreferrer"><code>tests/EntityManager.mysql.test.ts</code></a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="entitymanager-api"></a>EntityManager API<a aria-hidden="true" tabindex="-1" class="hash-link" href="#entitymanager-api" title="Direct link to heading">#</a></h2><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="getrepositoryt-extends-ientityentityname-string--entityclasst-entityrepositoryt"></a><code>getRepository&lt;T extends IEntity&gt;(entityName: string | EntityClass&lt;T&gt;): EntityRepository&lt;T&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#getrepositoryt-extends-ientityentityname-string--entityclasst-entityrepositoryt" title="Direct link to heading">#</a></h4><p>Returns <code>EntityRepository</code> for given entity, respects <code>customRepository</code> option of <code>@Entity</code>
and <code>entityRepository</code> option of <code>MikroORM.init()</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="findt-extends-ientityentityname-string--entityclasst-where-filterqueryt-options-findoptions-promiset"></a><code>find&lt;T extends IEntity&gt;(entityName: string | EntityClass&lt;T&gt;, where?: FilterQuery&lt;T&gt;, options?: FindOptions): Promise&lt;T[]&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#findt-extends-ientityentityname-string--entityclasst-where-filterqueryt-options-findoptions-promiset" title="Direct link to heading">#</a></h4><p>Returns array of entities found for given condition. You can specify <code>FindOptions</code> to request
population of referenced entities or control the pagination:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">interface</span><span class="token plain"> </span><span class="token class-name">FindOptions</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  populate</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  orderBy</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">k</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">QueryOrder</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  limit</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  offset</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div></div></div><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="findt-extends-ientityentityname-string--entityclasst-where-filterqueryt-populate-string-orderby--k-string-queryorder--limit-number-offset-number-promiset"></a><code>find&lt;T extends IEntity&gt;(entityName: string | EntityClass&lt;T&gt;, where?: FilterQuery&lt;T&gt;, populate?: string[], orderBy?: { [k: string]: QueryOrder }, limit?: number, offset?: number): Promise&lt;T[]&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#findt-extends-ientityentityname-string--entityclasst-where-filterqueryt-populate-string-orderby--k-string-queryorder--limit-number-offset-number-promiset" title="Direct link to heading">#</a></h4><p>Same as previous <code>find</code> method, just with dedicated parameters for <code>populate</code>, <code>orderBy</code>, <code>limit</code>
and <code>offset</code>.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="findonet-extends-ientityentityname-string--entityclasst-where-filterqueryt--string-populate-string-promiset--null"></a><code>findOne&lt;T extends IEntity&gt;(entityName: string | EntityClass&lt;T&gt;, where: FilterQuery&lt;T&gt; | string, populate?: string[]): Promise&lt;T | null&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#findonet-extends-ientityentityname-string--entityclasst-where-filterqueryt--string-populate-string-promiset--null" title="Direct link to heading">#</a></h4><p>Finds an entity by given <code>where</code> condition. You can use primary key as <code>where</code> value, then
if the entity is already managed, no database call will be made. </p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="merget-extends-ientityentityname-string--entityclasst-data-entitydatat-t"></a><code>merge&lt;T extends IEntity&gt;(entityName: string | EntityClass&lt;T&gt;, data: EntityData&lt;T&gt;): T</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#merget-extends-ientityentityname-string--entityclasst-data-entitydatat-t" title="Direct link to heading">#</a></h4><p>Adds given entity to current Identity Map. After merging, entity becomes managed.
This is useful when you want to work with cached entities. </p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="mapt-extends-ientityentityname-string--entityclasst-data-entitydatat-t"></a><code>map&lt;T extends IEntity&gt;(entityName: string | EntityClass&lt;T&gt;, data: EntityData&lt;T&gt;): T</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#mapt-extends-ientityentityname-string--entityclasst-data-entitydatat-t" title="Direct link to heading">#</a></h4><p>Maps raw DB result to entity, adding it to current Identity Map. Equivalent to
<code>IDatabaseDriver.mapResult()</code> followed by <code>EntityManager.merge()</code>.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="getreferencet-extends-ientityentityname-string--entityclasst-id-string-t"></a><code>getReference&lt;T extends IEntity&gt;(entityName: string | EntityClass&lt;T&gt;, id: string): T</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#getreferencet-extends-ientityentityname-string--entityclasst-id-string-t" title="Direct link to heading">#</a></h4><p>Gets a reference to the entity identified by the given type and identifier without actually
loading it, if the entity is not yet loaded.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="countentityname-string--entityclasst-where-any-promisenumber"></a><code>count(entityName: string | EntityClass&lt;T&gt;, where: any): Promise&lt;number&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#countentityname-string--entityclasst-where-any-promisenumber" title="Direct link to heading">#</a></h4><p>Gets count of entities matching the <code>where</code> condition. </p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="persistentity-ientity--ientity-flush-boolean-promisevoid"></a><code>persist(entity: IEntity | IEntity[], flush?: boolean): Promise&lt;void&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#persistentity-ientity--ientity-flush-boolean-promisevoid" title="Direct link to heading">#</a></h4><p>Tells the EntityManager to make an instance managed and persistent. The entity will be
entered into the database at or before transaction commit or as a result of the flush
operation. You can control immediate flushing via <code>flush</code> parameter and via <code>autoFlush</code>
configuration option. </p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="persistandflushentity-ientity--ientity-promisevoid"></a><code>persistAndFlush(entity: IEntity | IEntity[]): Promise&lt;void&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#persistandflushentity-ientity--ientity-promisevoid" title="Direct link to heading">#</a></h4><p>Shortcut for <code>persist</code> &amp; <code>flush</code>.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="persistlaterentity-ientity--ientity-void"></a><code>persistLater(entity: IEntity | IEntity[]): void</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#persistlaterentity-ientity--ientity-void" title="Direct link to heading">#</a></h4><p>Shortcut for just <code>persist</code>, without flushing. </p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="flush-promisevoid"></a><code>flush(): Promise&lt;void&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#flush-promisevoid" title="Direct link to heading">#</a></h4><p>Flushes all changes to objects that have been queued up to now to the database.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="removeentityname-string--entityclasst-where-ientity--any-flush-boolean-promisenumber"></a><code>remove(entityName: string | EntityClass&lt;T&gt;, where: IEntity | any, flush?: boolean): Promise&lt;number&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#removeentityname-string--entityclasst-where-ientity--any-flush-boolean-promisenumber" title="Direct link to heading">#</a></h4><p>When provided entity instance as <code>where</code> value, then it calls <code>removeEntity(entity, flush)</code>,
otherwise it fires delete query with given <code>where</code> condition. </p><p>This method fires <code>beforeDelete</code> and <code>afterDelete</code> hooks only if you provide entity instance.  </p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="removeentityentity-ientity-flush-boolean-promisenumber"></a><code>removeEntity(entity: IEntity, flush?: boolean): Promise&lt;number&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#removeentityentity-ientity-flush-boolean-promisenumber" title="Direct link to heading">#</a></h4><p>Removes an entity instance. A removed entity will be removed from the database at or before
transaction commit or as a result of the flush operation. You can control immediate flushing
via <code>flush</code> parameter and via <code>autoFlush</code> configuration option.</p><p>This method fires <code>beforeDelete</code> and <code>afterDelete</code> hooks.  </p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="removeandflushentity-ientity-promisevoid"></a><code>removeAndFlush(entity: IEntity): Promise&lt;void&gt;</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#removeandflushentity-ientity-promisevoid" title="Direct link to heading">#</a></h4><p>Shortcut for <code>removeEntity</code> &amp; <code>flush</code>.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="removelaterentity-ientity-void"></a><code>removeLater(entity: IEntity): void</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#removelaterentity-ientity-void" title="Direct link to heading">#</a></h4><p>Shortcut for <code>removeEntity</code> without flushing. </p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="clear-void"></a><code>clear(): void</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#clear-void" title="Direct link to heading">#</a></h4><p>Clears the EntityManager. All entities that are currently managed by this EntityManager
become detached.</p><hr><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="canpopulateentityname-string--entityclasst-property-string-boolean"></a><code>canPopulate(entityName: string | EntityClass&lt;T&gt;, property: string): boolean</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#canpopulateentityname-string--entityclasst-property-string-boolean" title="Direct link to heading">#</a></h4><p>Returns whether given entity has given property which can be populated (is reference or
collection).</p><hr><p><a href="/docs/2.7/index#table-of-contents">â† Back to table of contents</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/mikro-orm/mikro-orm/edit/master/docs/versioned_docs/version-2.7/entity-manager.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-10-21T15:37:18.000Z" class="docLastUpdatedAt_217_">10/21/2020</time> by <strong>Martin AdÃ¡mek</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/2.7/defining-entities"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Defining entities</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/2.7/repositories"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using EntityRepository instead of EntityManager Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#persist-and-flush" class="table-of-contents__link">Persist and flush</a></li><li><a href="#persisting-and-cascading" class="table-of-contents__link">Persisting and cascading</a><ul><li><a href="#auto-flushing" class="table-of-contents__link">Auto flushing</a></li></ul></li><li><a href="#fetching-entities-with-entitymanager" class="table-of-contents__link">Fetching entities with EntityManager</a><ul><li><a href="#fetching-partial-entities" class="table-of-contents__link">Fetching partial entities</a></li></ul></li><li><a href="#type-of-fetched-entities" class="table-of-contents__link">Type of fetched entities</a></li><li><a href="#entity-repositories" class="table-of-contents__link">Entity repositories</a></li><li><a href="#entitymanager-api" class="table-of-contents__link">EntityManager API</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Installation &amp; Usage</a></li><li class="footer__item"><a href="https://github.com/mikro-orm/mikro-orm#-quick-start" target="_blank" rel="noopener noreferrer" class="footer__link-item">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/upgrading-v3-to-v4">Migration from v3 to v4</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/3.6/installation">Version 3.6 docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/ask?tags=mikro-orm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://twitter.com/MikroOrm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><iframe src="https://ghbtns.com/github-btn.html?user=mikro-orm&amp;repo=mikro-orm&amp;type=star&amp;count=true" style="margin-top:10px" frameborder="0" scrolling="0" width="150" height="30" title="GitHub Stars"></iframe></li><li class="footer__item"><iframe src="https://ghbtns.com/github-btn.html?user=B4nan&amp;type=sponsor" frameborder="0" scrolling="0" width="150" height="30" title="Sponsor B4nan"></iframe></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="MikroORM" src="/img/logo-header.svg"></div>Copyright Â© 2018-2020 Martin AdÃ¡mek. Built with Docusaurus. Icons made by <a href="https://www.flaticon.com/authors/surang" title="surang">surang</a> and <a href="https://www.flaticon.com/authors/skyclick" title="Skyclick">Skyclick</a>.</div></div></footer></div>
<script src="/styles.6a75a1a0.js"></script>
<script src="/runtime~main.f90667eb.js"></script>
<script src="/main.0ac60c5e.js"></script>
<script src="/1.d471f77f.js"></script>
<script src="/2.70f15892.js"></script>
<script src="/3.85c74ff8.js"></script>
<script src="/1be78505.b2f3141d.js"></script>
<script src="/325.d47dc706.js"></script>
<script src="/eab67868.df58518e.js"></script>
<script src="/17896441.9e54765d.js"></script>
<script src="/b550954d.a15a6abb.js"></script>
</body>
</html>
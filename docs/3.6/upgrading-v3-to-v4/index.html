<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-135618258-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-135618258-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="MikroORM" href="/opensearch.xml">
<script src="/js/custom.js"></script><title data-react-helmet="true">Upgrading from v3 to v4 | MikroORM</title><meta data-react-helmet="true" name="docsearch:version" content="3.6"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Upgrading from v3 to v4 | MikroORM"><meta data-react-helmet="true" name="description" content="Following sections describe (hopefully) all breaking changes, most of them might be not valid"><meta data-react-helmet="true" property="og:description" content="Following sections describe (hopefully) all breaking changes, most of them might be not valid"><meta data-react-helmet="true" property="og:url" content="https://mikro-orm.io/docs/3.6/upgrading-v3-to-v4"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://mikro-orm.io/docs/3.6/upgrading-v3-to-v4"><link rel="stylesheet" href="/styles.3430c5d5.css">
<link rel="preload" href="/styles.6b9b6a5d.js" as="script">
<link rel="preload" href="/runtime~main.b7957081.js" as="script">
<link rel="preload" href="/main.2defdbb2.js" as="script">
<link rel="preload" href="/1.1b45db3b.js" as="script">
<link rel="preload" href="/2.4dd75d96.js" as="script">
<link rel="preload" href="/3.0b298aac.js" as="script">
<link rel="preload" href="/1be78505.9862615f.js" as="script">
<link rel="preload" href="/270.29c04970.js" as="script">
<link rel="preload" href="/a661f275.caffb0d7.js" as="script">
<link rel="preload" href="/17896441.d0267637.js" as="script">
<link rel="preload" href="/4c5821de.04eed13f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top navbarHideable_3046"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="MikroORM"><strong class="navbar__title"></strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a class="navbar__item navbar__link" href="/docs/3.6/installation">3.6</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/upgrading-v3-to-v4">Next</a></li><li><a class="dropdown__link" href="/docs/upgrading-v3-to-v4">4.1</a></li><li><a class="dropdown__link" href="/docs/4.0/upgrading-v3-to-v4">4.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/3.6/upgrading-v3-to-v4">3.6</a></li><li><a class="dropdown__link" href="/docs/2.7/installation">2.7</a></li></ul></div><a class="navbar__item navbar__link" href="/docs/installation">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" data-type="versions" href="/versions">latest: v4.1.0</a><a href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" title="Chat on Slack">Slack</a><a href="https://github.com/mikro-orm/mikro-orm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" title="View on GitHub">GitHub</a><a href="https://twitter.com/MikroORM" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" title="Twitter">Twitter</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="MikroORM"><strong class="navbar__title"></strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/upgrading-v3-to-v4">Next</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/upgrading-v3-to-v4">4.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/4.0/upgrading-v3-to-v4">4.0</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/3.6/upgrading-v3-to-v4">3.6</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/2.7/installation">2.7</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" data-type="versions" href="/versions">latest: v4.1.0</a></li><li class="menu__list-item"><a href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA" target="_blank" rel="noopener noreferrer" class="menu__link" title="Chat on Slack">Slack</a></li><li class="menu__list-item"><a href="https://github.com/mikro-orm/mikro-orm" target="_blank" rel="noopener noreferrer" class="menu__link" title="View on GitHub">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/MikroORM" target="_blank" rel="noopener noreferrer" class="menu__link" title="Twitter">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for MikroORM <strong>3.6</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/upgrading-v3-to-v4">latest version</a></strong> (4.1).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 3.6</span></div><header><h1 class="docTitle_1Lrw">Upgrading from v3 to v4</h1></header><div class="markdown"><blockquote><p>Following sections describe (hopefully) all breaking changes, most of them might be not valid
for you, like if you do not use custom <code>NamingStrategy</code> implementation, you do not care about
the interface being changed.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="node-10130-required"></a>Node 10.13.0+ required<a aria-hidden="true" tabindex="-1" class="hash-link" href="#node-10130-required" title="Direct link to heading">#</a></h2><p>Support for older node versions was dropped. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="typescript-37-required"></a>TypeScript 3.7+ required<a aria-hidden="true" tabindex="-1" class="hash-link" href="#typescript-37-required" title="Direct link to heading">#</a></h2><p>Support for older TypeScript versions was dropped. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="monorepo"></a>Monorepo<a aria-hidden="true" tabindex="-1" class="hash-link" href="#monorepo" title="Direct link to heading">#</a></h2><p>The ORM has been split into several packages. In v4 one needs to require
<code>@mikro-orm/core</code> and a driver package, e.g. <code>@mikro-orm/mysql</code>. This driver
package already contains the <code>mysql2</code> dependency, so you can remove that from
your <code>package.json</code>. </p><ul><li><code>@mikro-orm/core</code></li><li><code>@mikro-orm/reflection</code> - <code>TsMorphMetadataProvider</code></li><li><code>@mikro-orm/cli</code> - CLI support, requires entity-generator, migrator and knex</li><li><code>@mikro-orm/knex</code> - SQL support</li><li><code>@mikro-orm/entity-generator</code></li><li><code>@mikro-orm/migrations</code></li><li><code>@mikro-orm/mysql</code></li><li><code>@mikro-orm/mariadb</code></li><li><code>@mikro-orm/mysql-base</code> - Common implementation for mysql and mariadb (internal)</li><li><code>@mikro-orm/sqlite</code></li><li><code>@mikro-orm/postgresql</code></li><li><code>@mikro-orm/mongodb</code></li></ul><blockquote><p>For easier transition, meta package mikro-orm is still present, reexporting
core, reflection, migrations, entity-generator and cli packages. You should
<strong>not</strong> install both <code>mikro-orm</code> and <code>@mikro-orm/core</code> packages together. </p></blockquote><blockquote><p>You should prefer the <code>@mikro-orm/core</code> over <code>mikro-orm</code> package, there were
weird dependency issues reported with the <code>mikro-orm</code> meta-package. </p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="sqlentitymanager-and-mongoentitymanager"></a>SqlEntityManager and MongoEntityManager<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sqlentitymanager-and-mongoentitymanager" title="Direct link to heading">#</a></h2><p>In v4 the <code>core</code> package, where <code>EntityManager</code> and <code>EntityRepository</code> are
defined, is not dependent on knex, and therefore it cannot have a method
returning a <code>QueryBuilder</code>. You need to import the SQL flavour of the EM
from the driver package to access the <code>createQueryBuilder()</code> method.</p><blockquote><p>The SQL flavour of EM is actually called <code>SqlEntityManager</code>, it is exported both under
this name and under <code>EntityManager</code> alias, so you can just change the
location from where you import.</p></blockquote><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token maybe-class-name">EntityManager</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@mikro-orm/mysql&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// or any other SQL driver package</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">EntityManager</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> qb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createQueryBuilder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><p>Same applies for the <code>aggregate()</code> method in mongo driver:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token maybe-class-name">EntityManager</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@mikro-orm/mongodb&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">EntityManager</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">aggregate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token spread operator" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><blockquote><p>The mongo flavour of EM is actually called <code>MongoEntityManager</code>, it is exported both under
this name and under <code>EntityManager</code> alias, so you can just change the
location from where you import.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="different-default-pivottable"></a>Different default <code>pivotTable</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#different-default-pivottable" title="Direct link to heading">#</a></h2><p>Implementation of <code>UnderscoreNamingStrategy</code> and <code>EntityCaseNamingStrategy</code>
<code>joinTableName()</code> method has changed. You can use <code>pivotTable</code> on the owning side
of M:N relation to specify the table name manually. </p><p>Previously the table name did not respect property name, if one defined multiple
M:N relations between same entities, there were conflicts and one would have to
specify <code>pivotTable</code> name manually at least on one of them. With the new way,
we can be sure that the table name won&#x27;t conflict with other pivot tables. </p><p>Previously the name was constructed from 2 entity names as <code>entity_a_to_entity_b</code>,
ignoring the actual property name. In v4 the name will be <code>entity_a_coll_name</code> in
case of the collection property on the owning side being named <code>collName</code>. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="changes-in-folder-based-discovery-entitiesdirs-removed"></a>Changes in folder-based discovery (<code>entitiesDirs</code> removed)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#changes-in-folder-based-discovery-entitiesdirs-removed" title="Direct link to heading">#</a></h2><p><code>entitiesDirs</code> and <code>entitiesDirsTs</code> were removed in favour of <code>entities</code> and <code>entitiesTs</code>,
<code>entities</code> will be used as a default for <code>entitiesTs</code> (that is used when we detect <code>ts-node</code>).</p><p><code>entities</code> can now contain mixture of paths to directories, globs pointing to entities,
or references to the entities or instances of <code>EntitySchema</code>. </p><p>This basically means that all you need to change is renaming <code>entitiesDirs</code> to <code>entities</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token maybe-class-name">MikroORM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  entities</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;dist/**/entities&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;dist/**/*.entity.js&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">FooBar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">FooBaz</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  entitiesTs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;src/**/entities&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;src/**/*.entity.ts&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">FooBar</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token maybe-class-name">FooBaz</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="changes-in-wrap-helper-wrappedentity-interface-and-reference-wrapper"></a>Changes in <code>wrap()</code> helper, <code>WrappedEntity</code> interface and <code>Reference</code> wrapper<a aria-hidden="true" tabindex="-1" class="hash-link" href="#changes-in-wrap-helper-wrappedentity-interface-and-reference-wrapper" title="Direct link to heading">#</a></h2><p>Previously all the methods and properties of <code>WrappedEntity</code> interface were
added to the entity prototype during discovery. In v4 there is only one property
added: <code>__helper: WrappedEntity</code>. <code>WrappedEntity</code> has been converted to actual class.</p><p><code>wrap(entity)</code> no longer returns the entity, now the <code>WrappedEntity</code> instance is
being returned. It contains only public methods (<code>init</code>, <code>assign</code>, <code>isInitialized</code>, ...),
if you want to access internal properties like <code>__meta</code> or <code>__em</code>, you need to explicitly
ask for the helper via <code>wrap(entity, true)</code>.</p><p>Internal methods (with <code>__</code> prefix) were also removed from the <code>Reference</code> class,
use <code>wrap(ref, true)</code> to access them. </p><p>Instead of interface merging with <code>WrappedEntity</code>, one can now use classic inheritance,
by extending <code>BaseEntity</code> exported from <code>@mikro-orm/core</code>. If you do so, <code>wrap(entity)</code>
will return your entity. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="removed-flush-parameter-from-persist-and-remove-methods"></a>Removed <code>flush</code> parameter from <code>persist()</code> and <code>remove()</code> methods<a aria-hidden="true" tabindex="-1" class="hash-link" href="#removed-flush-parameter-from-persist-and-remove-methods" title="Direct link to heading">#</a></h2><p><code>flush</code> param is removed, both <code>persist</code> and <code>remove</code> methods are synchronous and
require explicit flushing, possibly via fluent interface call.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// before</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">persist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jon</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jon</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// after</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">persist</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jon</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">jon</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">flush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="remove-method-requires-entity-instances"></a><code>remove()</code> method requires entity instances<a aria-hidden="true" tabindex="-1" class="hash-link" href="#remove-method-requires-entity-instances" title="Direct link to heading">#</a></h2><p>The <code>em.remove()</code> method originally allowed to pass either entity instance, or
a condition. When one passed a condition, it was firing a native delete query,
without handling transactions or hooks. </p><p>In v4, the method is now simplified and works only with entity instances. Use
<code>em.nativeDelete()</code> explicitly if you want to fire a delete query instead of
letting the <code>UnitOfWork</code> doing its job.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// before</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// fires query directly</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// after </span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">nativeDelete</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">Author</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><blockquote><p><code>em.removeEntity()</code> has been removed in favour of <code>em.remove()</code> (that now has almost the same signature).</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="type-safe-references"></a>Type safe references<a aria-hidden="true" tabindex="-1" class="hash-link" href="#type-safe-references" title="Direct link to heading">#</a></h2><p>EM now returns <code>Loaded&lt;T, P&gt;</code> instead of the entity (<code>T</code>). This type automatically
adds synchronous method <code>get()</code> that returns the entity (for references) or array
of entities (for collections).</p><p><code>Reference.get()</code> is now available only with correct <code>Loaded</code> type hint and is used
as a sync getter for the entity, just like <code>unwrap()</code>. You can use <code>Reference.load(prop)</code>
for the original <code>get()</code> method functionality. </p><p><code>em.find()</code> and similar methods now have two type arguments, due to TypeScript not supporting partial
type inference, when you specify the <code>T</code> explicitly (without also explicitly
specifying the load hint), the inference will not work. This use case was mainly
for usage without classes (interfaces + <code>EntitySchema</code>) - in that case it is now
supported to pass actual instance of <code>EntitySchema</code> as the first parameter to these
methods, that will allow correct type inference:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> author </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> em</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">AuthorSchema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;books&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">author</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">books</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// `get()` is now inferred correctly</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="custom-types-are-now-type-safe"></a>Custom types are now type safe<a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom-types-are-now-type-safe" title="Direct link to heading">#</a></h2><p>Generic <code>Type</code> class has now two type arguments - the input and output types.
Input type defaults to <code>string</code>, output type defaults to the input type. </p><p>You might need to explicitly provide the types if your methods are strictly typed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="custom-type-serialization"></a>Custom type serialization<a aria-hidden="true" tabindex="-1" class="hash-link" href="#custom-type-serialization" title="Direct link to heading">#</a></h2><p>Custom types used to be serialized to the database value. In v4, the runtime
value is used by default. Implement custom <code>toJSON()</code> method if you need to
customize this.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="property-default-and-defaultraw"></a>Property <code>default</code> and <code>defaultRaw</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#property-default-and-defaultraw" title="Direct link to heading">#</a></h2><p>Previously the <code>default</code> option of properties was used as is, so we had to wrap
strings in quotes (e.g. <code>@Property({ default: &quot;&#x27;foo bar&#x27;&quot; })</code>). </p><p>In v4 the <code>default</code> is typed as <code>string | number | boolean | null</code> and when used
with string value, it will be automatically quoted. </p><p>To use SQL functions we now need to use <code>defaultRaw</code>: <code>@Property({ defaultRaw: &#x27;now()&#x27; })</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="autoflush-option-has-been-removed"></a><code>autoFlush</code> option has been removed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#autoflush-option-has-been-removed" title="Direct link to heading">#</a></h2><p>Also <code>persistLater()</code> and <code>removeLater()</code> methods are deprecated. Use <code>persist()</code> or
<code>remove</code> respectively.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="identity-uuidentity-and-mongoentity-interfaces-are-removed"></a><code>IdEntity</code>, <code>UuidEntity</code> and <code>MongoEntity</code> interfaces are removed<a aria-hidden="true" tabindex="-1" class="hash-link" href="#identity-uuidentity-and-mongoentity-interfaces-are-removed" title="Direct link to heading">#</a></h2><p>They were actually never needed. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="mongodb-driver-is-no-longer-the-default"></a>MongoDB driver is no longer the default<a aria-hidden="true" tabindex="-1" class="hash-link" href="#mongodb-driver-is-no-longer-the-default" title="Direct link to heading">#</a></h2><p>You need to specify the platform type either via <code>type</code> option or provide the driver
implementation via <code>driver</code> option. </p><p>Available platforms types: <code>[ &#x27;mongo&#x27;, &#x27;mysql&#x27;, &#x27;mariadb&#x27;, &#x27;postgresql&#x27;, &#x27;sqlite&#x27; ]</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="removed-configuration-discoverytsconfigpath"></a>Removed configuration <code>discovery.tsConfigPath</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#removed-configuration-discoverytsconfigpath" title="Direct link to heading">#</a></h2><p>Removed as it is no longer needed, it was used only for <code>TsMorphMetadataProvider</code>,
when the <code>entitiesDirsTs</code> were not explicitly provided. In v4, this is no longer
needed, as ts-morph discovery will use <code>d.ts</code> files instead, that should be located
next to the compiled entities. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="changes-in-query-highlighting"></a>Changes in query highlighting<a aria-hidden="true" tabindex="-1" class="hash-link" href="#changes-in-query-highlighting" title="Direct link to heading">#</a></h2><p>Previously Highlight.js was used to highlight various things in the CLI,
like SQL and mongo queries, or migrations or entities generated via CLI.
While the library worked fine, it was causing performance issues mainly
for those bundling via webpack and using lambdas, as the library was huge.</p><p>In v4 highlighting is disabled by default, and there are 2 highlighters
you can optionally use (you need to install them first).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-typescript codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token maybe-class-name">SqlHighlighter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;@mikro-orm/sql-highlighter&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">MikroORM</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  highlighter</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SqlHighlighter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></div></div></div></div></div><p>For MongoDB you can use <code>@mikro-orm/mongo-highlighter</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/mikro-orm/mikro-orm/edit/master/docs/versioned_docs/version-3.6/upgrading-v3-to-v4.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-09-08T18:32:59.000Z" class="docLastUpdatedAt_217_">9/8/2020</time> by <strong>Martin AdÃ¡mek</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#node-10130-required" class="table-of-contents__link">Node 10.13.0+ required</a></li><li><a href="#typescript-37-required" class="table-of-contents__link">TypeScript 3.7+ required</a></li><li><a href="#monorepo" class="table-of-contents__link">Monorepo</a></li><li><a href="#sqlentitymanager-and-mongoentitymanager" class="table-of-contents__link">SqlEntityManager and MongoEntityManager</a></li><li><a href="#different-default-pivottable" class="table-of-contents__link">Different default <code>pivotTable</code></a></li><li><a href="#changes-in-folder-based-discovery-entitiesdirs-removed" class="table-of-contents__link">Changes in folder-based discovery (<code>entitiesDirs</code> removed)</a></li><li><a href="#changes-in-wrap-helper-wrappedentity-interface-and-reference-wrapper" class="table-of-contents__link">Changes in <code>wrap()</code> helper, <code>WrappedEntity</code> interface and <code>Reference</code> wrapper</a></li><li><a href="#removed-flush-parameter-from-persist-and-remove-methods" class="table-of-contents__link">Removed <code>flush</code> parameter from <code>persist()</code> and <code>remove()</code> methods</a></li><li><a href="#remove-method-requires-entity-instances" class="table-of-contents__link"><code>remove()</code> method requires entity instances</a></li><li><a href="#type-safe-references" class="table-of-contents__link">Type safe references</a></li><li><a href="#custom-types-are-now-type-safe" class="table-of-contents__link">Custom types are now type safe</a></li><li><a href="#custom-type-serialization" class="table-of-contents__link">Custom type serialization</a></li><li><a href="#property-default-and-defaultraw" class="table-of-contents__link">Property <code>default</code> and <code>defaultRaw</code></a></li><li><a href="#autoflush-option-has-been-removed" class="table-of-contents__link"><code>autoFlush</code> option has been removed</a></li><li><a href="#identity-uuidentity-and-mongoentity-interfaces-are-removed" class="table-of-contents__link"><code>IdEntity</code>, <code>UuidEntity</code> and <code>MongoEntity</code> interfaces are removed</a></li><li><a href="#mongodb-driver-is-no-longer-the-default" class="table-of-contents__link">MongoDB driver is no longer the default</a></li><li><a href="#removed-configuration-discoverytsconfigpath" class="table-of-contents__link">Removed configuration <code>discovery.tsConfigPath</code></a></li><li><a href="#changes-in-query-highlighting" class="table-of-contents__link">Changes in query highlighting</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/installation">Installation &amp; Usage</a></li><li class="footer__item"><a href="https://github.com/mikro-orm/mikro-orm#-quick-start" target="_blank" rel="noopener noreferrer" class="footer__link-item">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/upgrading-v3-to-v4">Migration from v3 to v4</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/3.6/installation">Version 3.6 docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/mikroorm/shared_invite/enQtNTM1ODYzMzM4MDk3LWM4ZDExMjU5ZDhmNjA2MmM3MWMwZmExNjhhNDdiYTMwNWM0MGY5ZTE3ZjkyZTMzOWExNDgyYmMzNDE1NDI5NjA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/ask?tags=mikro-orm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://twitter.com/MikroOrm" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><iframe src="https://ghbtns.com/github-btn.html?user=mikro-orm&amp;repo=mikro-orm&amp;type=star&amp;count=true" style="margin-top:10px" frameborder="0" scrolling="0" width="100" height="30" title="GitHub Stars"></iframe></li><li class="footer__item"><iframe src="https://ghbtns.com/github-btn.html?user=B4nan&amp;type=sponsor" frameborder="0" scrolling="0" width="130" height="30" title="Sponsor B4nan"></iframe></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="MikroORM" src="/img/logo-header.svg"></div>Copyright Â© 2018-2020 Martin AdÃ¡mek. Built with Docusaurus. Icons made by <a href="https://www.flaticon.com/authors/surang" title="surang">surang</a> and <a href="https://www.flaticon.com/authors/skyclick" title="Skyclick">Skyclick</a>.</div></div></footer></div>
<script src="/styles.6b9b6a5d.js"></script>
<script src="/runtime~main.b7957081.js"></script>
<script src="/main.2defdbb2.js"></script>
<script src="/1.1b45db3b.js"></script>
<script src="/2.4dd75d96.js"></script>
<script src="/3.0b298aac.js"></script>
<script src="/1be78505.9862615f.js"></script>
<script src="/270.29c04970.js"></script>
<script src="/a661f275.caffb0d7.js"></script>
<script src="/17896441.d0267637.js"></script>
<script src="/4c5821de.04eed13f.js"></script>
</body>
</html>